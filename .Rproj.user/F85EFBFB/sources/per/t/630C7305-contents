library(fpp3) 
library(tidyverse)
library(USgas)

# Exercise 1 ----

# read the data: 
temp <- read_csv2(
  "https://raw.githubusercontent.com/holleland/BAN430/master/data/bergen_temp.csv")

# simulate white noise
set.seed(30)
y <- tsibble(sample = 1:50, wn = rnorm(50), index = sample)
y %>% autoplot(wn) + labs(title = "White noise", y = "")

y %>% 
  ACF(wn) %>% 
  autoplot() + labs(title = "White noise")

# Convert date column from character to date and temp to numeric:
temp <- temp %>% 
  mutate(date = as.Date(date, format = "%d.%m.%Y"),
         temp = as.numeric(temp))

# Creating a tsibble
temp.ts <- temp %>% as_tsibble(index = date)


# autoplot time series
temp.ts %>% autoplot(temp)

# example with key columns in tsibble object
citytemp <- read_csv2(
  "https://raw.githubusercontent.com/holleland/BAN430/master/data//citytemp.csv")

# important to specify key columns, otherwise dublicates error will be given
citytemp.ts <- citytemp %>% 
  mutate(date = as.Date(date, format = "%d.%m.%Y")) %>% 
  filter(!is.na(date)) %>%
  as_tsibble(index = date, 
             key = c("name","station"))

citytemp.ts %>% autoplot()


# Exercise 2 ----

# read the data
tute1 <- readr::read_csv("https://bit.ly/fpptute1")

# convert data to timeseries data
tute1 <- tute1 %>% 
  mutate(Quarter = yearquarter(Quarter)) %>% 
  as_tsibble(index = Quarter)

# create time series plot of each of the 3 series (sales, ad budget, gdp)
tute1 %>% 
  pivot_longer(-Quarter) %>% 
  ggplot(aes(x = Quarter, y = value, color = name)) +
  geom_line() +
  facet_grid(name ~ ., scales = "free_y")


# Exercise 3 ----

# transform to tsibble
us_total.ts <- us_total %>% 
  as_tibble() %>% 
  as_tsibble(index = "year", key = c("state"))

# plot time series for new england area
us_total.ts %>% 
  filter(state %in% c("Maine", "Vermont", "New Hampshire", "Massachusetts", "Connecticut","Rhode Island")) %>% 
  ggplot(aes(x = year, y = y, color = state)) +
  geom_line() + 
  facet_grid(state ~ ., scales = "free_y")


# Exercise 4 ----

# make a time plot
citytemp.ts %>% autoplot(meanTemp)

# make a seasonal plot
citytemp.ts %>% fill_gaps() %>%  gg_season(meanTemp, period = "year")

# make a seasonal subseries plot
# citytemp.ts %>% fill_gaps() %>%  gg_subseries(meanTemp) # this is bullshit


# Exercise 5 ----

# aggregate to weekly and monthly averages
citytemp.ts.wk <- citytemp.ts %>% 
  as_tibble() %>% 
  mutate(week = yearweek(date)) %>% 
  select(-date) %>% 
  group_by(week, name, station) %>% 
  summarise(meanTemp = mean(meanTemp)) %>% 
  as_tsibble(index = week,
             key = c("name", "station"))

citytemp.ts.mt <- citytemp.ts %>% 
  as_tibble() %>% 
  mutate(month = yearmonth(date)) %>% 
  select(-date) %>% 
  group_by(month, name, station) %>% 
  summarise(meanTemp = mean(meanTemp)) %>% 
  as_tsibble(index = month,
             key = c("name", "station"))

citytemp.ts.wk %>% autoplot(meanTemp)+facet_wrap(~name)
citytemp.ts.wk %>% fill_gaps() %>%  gg_season(meanTemp)

citytemp.ts.mt %>% autoplot(meanTemp)+facet_wrap(~name)
citytemp.ts.mt %>% gg_subseries(meanTemp)


# Exercise 6 ----

